<body>


    <div class="container">
        <h1>USUARIOS</h1>
        <hr>
        {{>message}}
        {{#if buscar }}
        <div class=" col-md-12">
            <div class="row g-3 needs-validation">
                <div class="col-md-2">
                    <a class="btn btn-success btn2 " href="/usuario" title="Refrescar"><i
                            class="fas fa-arrow-circle-left"> Refrescar</i></a>
                </div>
                <div class="col-md-6">

                    <a class="btn btn-success btn2" onclick="document.getElementById('Crear').style.display='block'"
                        title="Editar">
                        <i class="fa fa-plus"> Crear</i></a>
                    <div id="Crear" class="modal ">
                        <div class="modal-dialog .modal-fullscreen-xxl-down	">

                            <div class="modal-content">
                                <div class="modal-header">
                                    <h3 class="text-center">Agregar usuario</h3>
                                    <span onclick="document.getElementById('Crear').style.display='none'" class="closeF"
                                        title="Cerrar">x</span>

                                </div>
                                <form action="/usuario/add" method="POST">

                                    <div class="modal-body">

                                         <div class="card-body col-md-12">


                                            <div class="form-row">
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar nombre completo:
                                                    </label>
                                                    <input type="text" class="form-control" name="fullname"
                                                        placeholder="Nombre completo" autofocus required>

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el nombre.
                                                    </div>

                                                </div>
                                                <br>
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar nombre de usuario:
                                                    </label>
                                                    <input type="text" class="form-control" name="username"
                                                        placeholder="Nombre de usuario" autofocus required>

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el nombre.
                                                    </div>

                                                </div>
                                                <br>
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar correo electrónico:
                                                    </label>
                                                    <input type="text" class="form-control" name="email"
                                                        placeholder="correo electrónico" autofocus >

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el correo electrónico.
                                                    </div>

                                                </div>
                                                <br>
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar constraseña:
                                                    </label>
                                                    <input type="password" class="form-control" name="password"
                                                        placeholder="Contraseña" autofocus required>

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el nombre.
                                                    </div>

                                                </div>
                                                <br>
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar puesto:
                                                    </label>
                                                    <select class="form-control " name="idcargo" id="id"
                                                        aria-describedby="validationServer04Feedback" required>
                                                        <option selected disabled value="">Puesto</option>
                                                        {{#each puesto }}
                                                        <option value="{{idcargo}}" name="idcargo"> {{nombre_cargo}}
                                                        </option>
                                                        {{/each}}
                                                    </select>


                                                </div>
                                                <br>
                                                <div class="form-row">
                                                    <div class="form-group col-md-12">
                                                        <label for="validationServer03"> Agregar sucursal:
                                                        </label>
                                                        <select class="form-control "
                                                            name="sucursal" id="id"
                                                            aria-describedby="validationServer04Feedback" required>
                                                            <option selected disabled value="">Sucursal</option>
                                                            {{#each sucursal }}
                                                            <option value="{{nombre}}" name="sucursal"> {{nombre}}
                                                            </option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>


                                        
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success">Guardar</button>
                                    </div>
                                </form>


                            </div>
                        </div>

                    </div>

                </div>
                <div class=" col-md-3">
                    <form action="/usuario" method="POST">

                        <input type="text" class="form-control" placeholder="Buscar" aria-label="Recipient's username"
                            aria-describedby="button-addon2" name="buscar">
                </div>

                <div class="col-md-1">

                    <button class="btn btn-success" type="submit" id="button-addon2">Buscar</button>
                </div>
                </form>
                {{!-- <div class="form-group col-md-4">
                    <form action="/Sucursales" method="POST">
                        <div class="input-group mb-3 ">
                            <input type="text" class="form-control" placeholder="Buscar"
                                aria-label="Recipient's username" aria-describedby="button-addon2" name="buscar">
                            <button class="btn btn-success" type="submit" id="button-addon2">Buscar</button>
                        </div>
                    </form>
                </div> --}}

            </div>
        </div>
        {{else}}

        <div class=" col-md-12">
            <div class="row g-3 needs-validation">
                <div class="col-md-8">

                    <a class="btn btn-success btn2" onclick="document.getElementById('Crear').style.display='block'"
                        title="Editar">
                        <i class="fa fa-plus"> Crear</i></a>
                    <div id="Crear" class="modal ">
                        <div class="modal-dialog .modal-fullscreen-xxl-down	">

                            <div class="modal-content">
                                <div class="modal-header">
                                    <h3 class="text-center">Agregar Usuario</h3>
                                    <span onclick="document.getElementById('Crear').style.display='none'" class="closeF"
                                        title="Cerrar">x</span>

                                </div>
                                <form action="/usuario/add" method="POST">

                                    <div class="modal-body">

                                        <div class="card-body col-md-12">


                                            <div class="form-row">
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar nombre completo:
                                                    </label>
                                                    <input type="text" class="form-control" name="fullname"
                                                        placeholder="Nombre completo" autofocus required>

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el nombre.
                                                    </div>

                                                </div>
                                                <br>
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar nombre de usuario:
                                                    </label>
                                                    <input type="text" class="form-control" name="username"
                                                        placeholder="Nombre de usuario" autofocus required>

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el nombre.
                                                    </div>

                                                </div>
                                                <br>
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar correo electrónico:
                                                    </label>
                                                    <input type="text" class="form-control" name="email"
                                                        placeholder="correo electrónico" autofocus >

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el correo electrónico.
                                                    </div>

                                                </div>
                                                <br>
                                                <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar constraseña:
                                                    </label>
                                                    <input type="password" class="form-control" name="password"
                                                        placeholder="Contraseña" autofocus required>

                                                    <div class="invalid-tooltip">
                                                        Por favor ingrese el nombre.
                                                    </div>

                                                </div>
                                                 <div class="form-group col-md-12">
                                                            <label for="validationServer03"> Rol:
                                                            </label>
                                                            <select class="form-control " name="rol" id="id"
                                                                aria-describedby="validationServer04Feedback">
                                                                
                                                                <option value="Admin" name="rol"> Admin</option>
                                                                <option value="General" name="rol"> General</option>
                                                                <option value="Bodega" name="rol"> Bodega</option>
                                                                <option value="Medico" name="rol"> Médico</option>

                                                            </select>

                                                            <div class="invalid-tooltip">
                                                                Por favor ingrese el nombre.
                                                            </div>

                                                        </div>
                                                <br>
                                                 <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar puesto:
                                                    </label>
                                                    <select class="form-control " name="idcargo" id="id"
                                                        aria-describedby="validationServer04Feedback" required>
                                                        <option selected disabled value="">Puesto</option>
                                                        {{#each puesto }}
                                                        <option value="{{idcargo}}" name="idcargo"> {{nombre_cargo}}
                                                        </option>
                                                        {{/each}}
                                                    </select>


                                                </div>
                                               
                                                <br>
                                                <div class="form-row">
                                                    <div class="form-group col-md-12">
                                                        <label for="validationServer03"> Agregar sucursal:
                                                        </label>
                                                        <select class="form-control "
                                                            name="sucursal" id="id"
                                                            aria-describedby="validationServer04Feedback" required>
                                                            <option selected disabled value="">Sucursal</option>
                                                            {{#each sucursal }}
                                                            <option value="{{nombre}}" name="sucursal"> {{nombre}}
                                                            </option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success">Guardar</button>
                                    </div>
                                </form>


                            </div>
                        </div>

                    </div>

                </div>

                <div class=" col-md-3">
                    <form action="/usuario" method="POST">

                        <input type="text" class="form-control" placeholder="Buscar" aria-label="Recipient's username"
                            aria-describedby="button-addon2" name="buscar">
                </div>

                <div class="col-md-1">

                    <button class="btn btn-success" type="submit" id="button-addon2">Buscar</button>
                </div>
                </form>



            </div>
        </div>

        {{/if}}
        <br>
        <!-- Button trigger modal -->



        <div class="form-group" hidden>
            <!--		Show Numbers Of Rows 		-->
            <select class="form-control" name="state" id="maxRows">
                <option value="5000">Show ALL Rows</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="70">70</option>
                <option value="100">100</option>
            </select>

        </div>
        <div class="table-responsive">

            <table
                class="table table-primary  table-hover table-hovertable-striped table-class  table-bordered border-light  "
                id="table-id">

                <thead class="table-dark">
                    <tr>
                        <th>Nombre </th>
                        <th>Apellidos</th>
                        <th>Email</th>
                        <th></th>
                        <th></th>
                        <th></th>


                    </tr>
                </thead>
                <tbody>
                    {{#each usuario }}
                    <tr>
                        <td>{{nombres}}</td>
                        <td>{{apellidos}}</td>
                        <td>{{email}}</td>




                        <td>


                            <a onclick="document.getElementById('{{id}}').style.display='block'" title="Eliminar">
                                <i class="fas fa-trash-alt" title="Eliminar" style="color: #f80000;  "
                                    aria-hidden="true"></i></a>
                            <div id="{{id}}" class="modal">

                                <div class="modal-dialog .modal-fullscreen-xxl-down	">

                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h3 class="text-center">Eliminar usuario</h3>
                                            <span onclick="document.getElementById('{{id}}').style.display='none'"
                                                class="closeF" title="Cerrar">x</span>

                                        </div>
                                        <div class="modal-body">

                                            <div class="card-body col-md-12">
                                                <h3 class="text-center">Eliminar: {{fullname}}</h3>

                                                <p>¿Esta seguro que desea eliminar?</p>


                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button"
                                                onclick="document.getElementById('{{id}}').style.display='none'"
                                                class="btn btn-outline-light">CANCELAR</button>


                                            <a href="/usuario/delete/{{id}}" class="btn btn-danger" aria-label="borrar"
                                                title="Eliminar">
                                                ELIMINAR
                                            </a>
                                        </div>


                                    </div>
                                </div>
                            </div>

                        </td>
                        <td>


                            <a onclick="document.getElementById('{{fullname}}').style.display='block'" title="Editar">
                                <i class="fas fa-pencil-alt" title="Editar" style="color: #0A1251;  "
                                    aria-hidden="true"></i></a>

                            <div id="{{fullname}}" class="modal">
                                <div class="modal-dialog .modal-fullscreen-xxl-down	">

                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h3 class="text-center">Modificar Usuario</h3>
                                            <span onclick="document.getElementById('{{fullname}}').style.display='none'"
                                                class="closeF" title="Cerrar">x</span>

                                        </div>
                                        <form action="/usuario/edit/{{id}}" method="POST">

                                            <div class="modal-body">

                                                <div class="card-body col-md-12">


                                                    <div class="form-row">
                                                        <div class="form-group col-md-12">
                                                            <label for="validationServer03"> Nombre Completo:
                                                            </label>
                                                            <input type="text" class="form-control" name="fullname"
                                                                value="{{fullname}}">

                                                            <div class="invalid-tooltip">
                                                                Por favor ingrese el nombre.
                                                            </div>

                                                        </div>
                                                        <br>
                                                        <div class="form-group col-md-12">
                                                            <label for="validationServer03"> Nombre de usuario:
                                                            </label>
                                                            <input type="text" class="form-control" name="username"
                                                                value="{{username}}">

                                                            <div class="invalid-tooltip">
                                                                Por favor ingrese el nombre.
                                                            </div>

                                                        </div>

                                                        <div class="form-group col-md-12">
                                                            <label for="validationServer03"> Correo electrónico:
                                                            </label>
                                                            <input type="text" class="form-control" name="email"
                                                                value="{{email}}">

                                                            <div class="invalid-tooltip">
                                                                Por favor ingrese el correo electrónico.
                                                            </div>

                                                        </div>

                                                        <div class="form-group col-md-12">
                                                            <label for="validationServer03"> Rol:
                                                            </label>
                                                            <select class="form-control " name="rol" id="id"
                                                                aria-describedby="validationServer04Feedback">
                                                                <option value="{{usuario.rol}}">{{rol}}
                                                                </option>
                                                                <option value="Admin" name="rol"> Admin</option>
                                                                <option value="General" name="rol"> General</option>
                                                                <option value="Bodega" name="rol"> Bodega</option>
                                                                <option value="Medico" name="rol"> Médico</option>

                                                            </select>

                                                            <div class="invalid-tooltip">
                                                                Por favor ingrese el nombre.
                                                            </div>

                                                        </div>




                                                       <div class="form-group col-md-12">
                                                    <label for="validationServer03"> Agregar puesto:
                                                    </label>
                                                    <select class="form-control " name="idcargo" id="id"
                                                        aria-describedby="validationServer04Feedback" required>
                                                        <option value="{{idcargo}}">{{nombre_cargo}}</option>
                                                        {{#each ../puesto as |puesto|}}
                                                        <option value="{{puesto.idcargo}}" name="idcargo"> {{puesto.nombre_cargo}}
                                                        </option>
                                                        {{/each}}
                                                    </select>


                                                </div>
                                                           
                                                    <div class="form-group col-md-12">
                                                        <label for="validationServer03"> Agregar sucursal:
                                                        </label>
                                                        <select class="form-control "
                                                            name="sucursal" id="id"
                                                            aria-describedby="validationServer04Feedback" required>
                                                            <option  value="{{sucursal}}">{{nombre}}</option>
                                                            {{#each ../sucursal as |sucursal|}}
                                                            <option value="{{nombre}}" name="sucursal"> {{nombre}}
                                                            </option>
                                                            {{/each}}
                                                        </select>
                                                   
                                                </div>

                                                    </div>

                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="submit" class="btn btn-success">Guardar</button>
                                            </div>
                                        </form>


                                    </div>
                                </div>
                            </div>
                        </td>





                        <td>
                            {{!-- <a href="/usuario/editpass/{{id}}">

                            </a> --}}
                            <a onclick="document.getElementById('{{email}}').style.display='block'"
                                title="Cambiar contraseña">
                                <i class="fas fa-unlock-alt" title="Cambiar contraseña"
                                    style="color: rgb(255, 174, 0);"></i></a>

                            <div id="{{email}}" class="modal">
                                <div class="modal-dialog .modal-fullscreen-xxl-down	">

                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h3 class="text-center">Modificar Contraseña</h3>
                                            <span onclick="document.getElementById('{{email}}').style.display='none'"
                                                class="closeF" title="Cerrar">x</span>

                                        </div>
                                        <form action="/usuario/editpass/{{email}}" method="POST">

                                            <div class="modal-body">

                                                <div class="card-body col-md-12">


                                                    <div class="form-row">
                                                        <div class="form-group col-md-12">
                                                            <label for="validationServer03">Contraseña de : {{email}} 
                                                            </label>
                                                            <br>
                                                            <input type="password" name="password" class="form-control"
                                                                placeholder="Nueva contraseña" autofocus>
                                                            <br>

                                                            <div class="invalid-tooltip">
                                                                Por favor ingrese el nombre.
                                                            </div>

                                                        </div>


                                                    </div>

                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="submit" class="btn btn-success">Guardar</button>
                                            </div>
                                        </form>


                                    </div>
                                </div>
                            </div>

                        </td>





                    </tr>
                    {{else}}
                    <th></th>
                    <th>Aún no se han agregado datos.</th>
                    <th></th>
                    <th></th>
                    </tr>
                    {{/each}}
                </tbody>

            </table>
        </div>

        <!--		Start Pagination -->

        <div class='pagination-container'>
            <nav>
                <ul class="pagination">

                    <li data-page="prev">
                        <span> &laquo <span class="sr-only">(current)</span></span>
                    </li>


                    <!--	Here the JS Function Will Add the Rows -->

                    <li data-page="next" id="prev">
                        <span> &raquo <span class="sr-only">(current)</span></span>
                    </li>

                </ul>
            </nav>



        </div>



        <!--  Developed By Yasser Mas -->
        <!-- partial -->
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
        <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js'></script>
        <script src="./script.js"></script>
        <script>

            getPagination('#table-id');
            //getPagination('.table-class');
            //getPagination('table');

            /*					PAGINATION 
            - on change max rows select options fade out all rows gt option value mx = 5
            - append pagination list as per numbers of rows / max rows option (20row/5= 4pages )
            - each pagination li on click -> fade out all tr gt max rows * li num and (5*pagenum 2 = 10 rows)
            - fade out all tr lt max rows * li num - max rows ((5*pagenum 2 = 10) - 5)
            - fade in all tr between (maxRows*PageNum) and (maxRows*pageNum)- MaxRows 
            */


            function getPagination(table) {

                var lastPage = 1;

                $('#maxRows')
                    .on('change', function (evt) {
                        //$('.paginationprev').html('');						// reset pagination

                        lastPage = 1;
                        $('.pagination')
                            .find('li')
                            .slice(1, -1)
                            .remove();
                        var trnum = 0; // reset tr counter
                        var maxRows = parseInt($(this).val()); // get Max Rows from select option

                        if (maxRows == 5000) {
                            $('.pagination').hide();
                        } else {
                            $('.pagination').show();
                        }

                        var totalRows = $(table + ' tbody tr').length; // numbers of rows
                        $(table + ' tr:gt(0)').each(function () {
                            // each TR in  table and not the header
                            trnum++; // Start Counter
                            if (trnum > maxRows) {
                                // if tr number gt maxRows

                                $(this).hide(); // fade it out
                            }
                            if (trnum <= maxRows) {
                                $(this).show();
                            } // else fade in Important in case if it ..
                        }); //  was fade out to fade it in
                        if (totalRows > maxRows) {
                            // if tr total rows gt max rows option
                            var pagenum = Math.ceil(totalRows / maxRows); // ceil total(rows/maxrows) to get ..
                            //	numbers of pages
                            for (var i = 1; i <= pagenum;) {
                                // for each page append pagination li
                                $('.pagination #prev')
                                    .before(
                                        '<li data-page="' +
                                        i +
                                        '">\
								  <span>' +
                                        i++ +
                                        '<span class="sr-only">(current)</span></span>\
								</li>'
                                    )
                                    .show();
                            } // end for i
                        } // end if row count > max rows

                        $('.pagination [data-page="1"]').addClass('active'); // add active class to the first li
                        $('.pagination li').on('click', function (evt) {
                            // on click each page
                            evt.stopImmediatePropagation();
                            evt.preventDefault();
                            var pageNum = $(this).attr('data-page'); // get it's number

                            var maxRows = parseInt($('#maxRows').val()); // get Max Rows from select option

                            if (pageNum == 'prev') {
                                if (lastPage == 1) {
                                    return;
                                }
                                pageNum = --lastPage;
                            }
                            if (pageNum == 'next') {
                                if (lastPage == $('.pagination li').length - 2) {
                                    return;
                                }
                                pageNum = ++lastPage;
                            }

                            lastPage = pageNum;
                            var trIndex = 0; // reset tr counter
                            $('.pagination li').removeClass('active'); // remove active class from all li
                            $('.pagination [data-page="' + lastPage + '"]').addClass('active'); // add active class to the clicked
                            // $(this).addClass('active');					// add active class to the clicked
                            limitPagging();
                            $(table + ' tr:gt(0)').each(function () {
                                // each tr in table not the header
                                trIndex++; // tr index counter
                                // if tr index gt maxRows*pageNum or lt maxRows*pageNum-maxRows fade if out
                                if (
                                    trIndex > maxRows * pageNum ||
                                    trIndex <= maxRows * pageNum - maxRows
                                ) {
                                    $(this).hide();
                                } else {
                                    $(this).show();
                                } //else fade in
                            }); // end of for each tr in table
                        }); // end of on click pagination list
                        limitPagging();
                    })
                    .val(5)
                    .change();

                // end of on select change

                // END OF PAGINATION
            }

            function limitPagging() {
                // alert($('.pagination li').length)

                if ($('.pagination li').length > 7) {
                    if ($('.pagination li.active').attr('data-page') <= 3) {
                        $('.pagination li:gt(5)').hide();
                        $('.pagination li:lt(5)').show();
                        $('.pagination [data-page="next"]').show();
                    } if ($('.pagination li.active').attr('data-page') > 3) {
                        $('.pagination li:gt(0)').hide();
                        $('.pagination [data-page="next"]').show();
                        for (let i = (parseInt($('.pagination li.active').attr('data-page')) - 2); i <= (parseInt($('.pagination li.active').attr('data-page')) + 2); i++) {
                            $('.pagination [data-page="' + i + '"]').show();

                        }

                    }
                }
            }

            $(function () {
                // Just to append id number for each row
                $('table tr:eq(0)').prepend('<th> ID </th>');

                var id = 0;

                $('table tr:gt(0)').each(function () {
                    id++;
                    $(this).prepend('<td>' + id + '</td>');
                });
            });

        </script>
        <script>
            const $select = document.querySelector("#miSelect");



            const opcionCambiada = () => {
                console.log("Cambio");
            };

            $select.addEventListener("change", opcionCambiada);

            const agregar = () => {
                const option = document.createElement('option');
                const valor = new Date().getTime();
                option.value = valor;
                option.text = valor;
                $select.appendChild(option);
            };

            const limpiar = () => {
                for (let i = $select.options.length; i >= 0; i--) {
                    $select.remove(i);
                }
            };

            const mostrar = () => {
                const indice = $select.selectedIndex;
                if (indice === -1) return; // Esto es cuando no hay elementos
                const opcionSeleccionada = $select.options[indice];
                alert(`Texto: ${opcionSeleccionada.text}. Valor: ${opcionSeleccionada.value}`);
            };

            document.addEventListener("DOMContentLoaded", () => {
                document.querySelector("#btnAgregar").addEventListener("click", agregar);
                document.querySelector("#btnLimpiar").addEventListener("click", limpiar);
                document.querySelector("#btnMostrar").addEventListener("click", mostrar);
            });



        </script>
    </div> <!-- 		End of Container -->